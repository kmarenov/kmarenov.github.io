---
layout: post
title:  "Vagrant для веб-разработчика"
date:   2016-01-01 18:43:15
categories: 
---

## Содержание
- [Введение](#intro)
- [Установка и настройка](#install)
- [Дополнительные материалы](#additional)

## <a name="intro"></a> Введение
Речь пойдет о замечательном инструменте, который называется `Vagrant`, и о том, чем он может быть полезен для веб-разработчика. 

Каждый разработчик в процессе разработки веб-приложений сталкивается с необходимостью настройки на своей машине окружения, необходимого для их запуска. В состав окружения могут входить, например: PHP, MySQL, nginx, а также другие СУБД, веб-сервера и т. д.

Есть разные способы управления окружениями: кто-то вручную по-отдельности устанавливает и настраивает в системе каждый из необходимых компонентов, кто-то использует готовые наборы (например XAMPP, Open Server в Windows или lamp-server в Linux), но у этих подходов есть несколько недостатков, главный из которых заключается в трудности поддержки разных окружений для разных проектов. Нередко возникают ситуации, когда, например, разные проекты работают с разными версиями PHP, или им нужны разные настройки php.ini, или разные веб-сервера и т. д. В таких случаях управление окружением становится довольно трудоемкой задачей, решить которую человеку, не имеющему квалификации сисадмина, бывает весьма непросто. В добавок - операционная система вашего компьютера "обрастает" большим количеством разного софта, который зачастую нужен только для того что-бы запустить локально какое-то одно веб-приложение. 

Я пользуюсь Vagrant для управления окружениями, и вот почему:

* Vagrant использует виртуализацию, а это в свою очередь дает следующие преимущества:

    * Для каждого проекта имеется индивидуальное окружение со своей версией PHP, своими настройками php.ini, веб-сервером и т. д., то есть - полностью изолированная виртуальная машина.

    * Операционная система компьютера не "засоряется" различным программным обеспечением, которое, по большому счету, в ней не нужно.

* Vagrant на лету синхронизирует каталог проекта с каталогом внутри виртуальной машины. Не нужно заботиться об обновлении версий файлов внутри нее. Все происходит автоматически и мгновенно.

* Управление окружением производится минимальным набором простых команд. В самом простом случае работа с Vagrant сводится к двум командам: `vagrant up` (запуск) и `vagrant halt` (остановка). 


Vagrant является оберткой над ПО виртуализации (VirtualBox, VMware и др.) и средствами управления конфигурациями (Chef, Salt, Puppet), и предоставляет способ легко и быстро всем этим управлять.

## <a name="install"></a> Установка и настройка

Рассмотрим по шагам процесс установки Vagrant, а также развернем для примера [готовый образ](https://box.scotch.io/) (или, как принято говорить в терминологии Vagrant - бокс) с преднастроенным [LAMP-стеком](https://ru.wikipedia.org/wiki/LAMP) и запустим в получившимся окружении веб-приложение (возьмем для примера [Yii 2 Basic Application Template](https://github.com/yiisoft/yii2-app-basic)).

Я использую Linux Mint, поэтому процесс установки будет описан для этой ОС (в Ubuntu, на основе которой посторен Mint, все будет аналогично). Порядок установки в Windows должен быть таким же, но сам процесс будет отличаться. К сожалению, я не могу ничего сказать, насчет того, насколько стабильно все будет работать в Windows, однако все описанное ПО имеет версии для Windows, поэтому, надо полагать, там тоже все должно работать.

Итак, поехали.

### Установка VirtualBox
Так как Vagrant оперирует виртуальными машинами, то ему для работы необходимо ПО виртуализации. Установим VirtualBox, который является широко распространенным, удобным и простым в использовании примером такого ПО.
Для установки следуйте инструкциям со страницы:
[https://www.virtualbox.org/wiki/Linux_Downloads](https://www.virtualbox.org/wiki/Linux_Downloads)

### Установка Vagrant
Затем установим сам Vagrant.

Для установки выполните:
{% highlight bash %}
$ sudo apt-get install vagrant
{% endhighlight %}

Или скачайте и установите последнюю версию отсюда:
[https://www.vagrantup.com/downloads.html](https://www.vagrantup.com/downloads.html)

### Установка плагинов Vagrant
Рекомендую установить пару полезных плагинов для Vagrant.

Плагин `vbguest` нужен на тот случай, когда версии VirtualBox Guest Additions внутри виртуальной машины и на вашем компьютере различаются, он сам в автоматическом режиме разрешит данную проблему. Для установки выполним:
{% highlight bash %}
$ vagrant plugin install vagrant-vbguest
{% endhighlight %}

Плагин `hostmanager` нужен для того, чтобы Vagrant мог управлять именами хостов для виртуальных машин. Установим его:
{% highlight bash %}
$ vagrant plugin install vagrant-hostmanager
{% endhighlight %}

### Загрузка файла конфигурации для Vagrant
Как уже говорилось выше, мы будем запускать уже готовое сконфигурированное окружение - [Scotch Box](https://box.scotch.io/).
В репозитории Scotch Box содержится файл `Vagrantfile`, который содержит всю необходимую Vagrant информацию для развертывания и запуска окружения.
Скачаем репозиторий:
{% highlight bash %}
$ git clone https://github.com/scotch-io/scotch-box.git
{% endhighlight %}

### Развертывание и запуск окружения
Для того, чтобы Vagrant развернул и запустил окружение, необходимо выполнить в каталоге проекта, то есть там, где находится файл `Vagrantfile` единственную команду `vagrant up`.
Перейдем в каталог, куда мы скачали репозитоий Scotch Box и сделаем это.
{% highlight bash %}
$ cd scotch-box
$ vagrant up
{% endhighlight %}

Это на самом деле все, что нужно сделать. Первый запуск обычно занимает довольно длительное время, так как Vagrant должен скачать и развернуть образ виртуальной машины, разрешить конфликт версий VirtualBox Guest Additions, если он есть, а также установить, при необходимости, различное программное обеспечение внутри виртуальной машины. Второй и последующие запуски будут осуществляться за считанные секунды.
